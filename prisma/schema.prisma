generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  phone     String?
  age       Int?
  avatar    String?
  role      Role     @default(ATHLETE)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  athleteProfile AthleteProfile?
  coachProfile   CoachProfile?

  @@map("users")
}

model AthleteProfile {
  id               String            @id @default(cuid())
  userId           String            @unique
  user             User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  level            Level             @default(BEGINNER)
  status           AthleteStatus     @default(ACTIVE)
  currentPlanId    String?
  currentPlan      TrainingPlan?     @relation(fields: [currentPlanId], references: [id])
  currentProgress  Int               @default(0)
  completedTrainings Int             @default(0)
  averageTime      String?
  averagePace      String?

  // Relations
  trainings        Training[]
  activities       Activity[]
  coachId          String?
  coach            CoachProfile?     @relation(fields: [coachId], references: [id])
  challengeParticipations ChallengeParticipant[]
  physicalTests    PhysicalTest[]

  @@map("athlete_profiles")
}

model CoachProfile {
  id          String   @id @default(cuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Relations
  athletes    AthleteProfile[]
  trainingPlans TrainingPlan[]
  challenges  Challenge[]
  races       Race[]

  @@map("coach_profiles")
}

model TrainingPlan {
  id            String         @id @default(cuid())
  name          String
  category      PlanCategory
  duration      Int            // weeks
  daysPerWeek   Int
  status        PlanStatus     @default(ACTIVE)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  // Relations
  createdById   String
  createdBy     CoachProfile   @relation(fields: [createdById], references: [id])
  athletes      AthleteProfile[]
  trainings     Training[]
  weeklyProgramming WeeklyProgramming[]

  @@map("training_plans")
}

model Training {
  id          String        @id @default(cuid())
  date        DateTime
  type        TrainingType
  distance    String
  duration    String
  pace        String
  notes       String?
  status      TrainingStatus @default(PENDING)
  weekNumber  Int?
  
  // Relations
  athleteId   String
  athlete     AthleteProfile @relation(fields: [athleteId], references: [id], onDelete: Cascade)
  planId      String?
  plan        TrainingPlan?  @relation(fields: [planId], references: [id])
  
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@map("trainings")
}

model Activity {
  id          String   @id @default(cuid())
  type        String
  distance    String
  time        String
  pace        String?
  notes       String?
  
  // Relations
  athleteId   String
  athlete     AthleteProfile @relation(fields: [athleteId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime @default(now())

  @@map("activities")
}

enum Role {
  ATHLETE
  COACH
  ADMIN
}

enum Level {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

enum AthleteStatus {
  PENDING
  ACTIVE
  INACTIVE
}

enum PlanCategory {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  FIVE_K
  TEN_K
  HALF_MARATHON
  MARATHON
}

enum PlanStatus {
  ACTIVE
  DRAFT
  ARCHIVED
}

enum TrainingType {
  CONTINUOUS_RUN
  INTERVAL_TRAINING
  LONG_RUN
  FARTLEK
  HILL_TRAINING
  LIGHT_JOG
  RECOVERY_RUN
}

enum TrainingStatus {
  PENDING
  COMPLETED
  MISSED
}

model Challenge {
  id           String            @id @default(cuid())
  name         String
  objective    String
  duration     Int               // em dias
  startDate    DateTime
  endDate      DateTime
  reward       String?
  status       ChallengeStatus   @default(ACTIVE)
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt

  // Relations
  createdById  String
  createdBy    CoachProfile      @relation(fields: [createdById], references: [id])
  participants ChallengeParticipant[]

  @@map("challenges")
}

model ChallengeParticipant {
  id          String     @id @default(cuid())
  challengeId String
  challenge   Challenge  @relation(fields: [challengeId], references: [id], onDelete: Cascade)
  athleteId   String
  athlete     AthleteProfile @relation(fields: [athleteId], references: [id], onDelete: Cascade)
  progress    Int        @default(0)
  points      Int        @default(0)
  joinedAt    DateTime   @default(now())

  @@unique([challengeId, athleteId])
  @@map("challenge_participants")
}

model PhysicalTest {
  id          String           @id @default(cuid())
  athleteId   String
  athlete     AthleteProfile   @relation(fields: [athleteId], references: [id], onDelete: Cascade)
  testType    PhysicalTestType
  pace        String           // formato: mm:ss
  finalTime   String
  distance    Float?           // para teste de 12 minutos
  testDate    DateTime
  createdAt   DateTime         @default(now())

  @@map("physical_tests")
}

model Race {
  id         String     @id @default(cuid())
  name       String
  distances  String[]   // ['3km', '5km', '10km', etc]
  city       String
  state      String
  raceDate   DateTime
  timeOfDay  TimeOfDay?
  link       String?
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  // Relations
  createdById String
  createdBy   CoachProfile @relation(fields: [createdById], references: [id])

  @@map("races")
}

model WeeklyProgramming {
  id            String        @id @default(cuid())
  planId        String
  plan          TrainingPlan  @relation(fields: [planId], references: [id], onDelete: Cascade)
  week          Int
  monday        String?       // JSON string com detalhes do treino
  tuesday       String?
  wednesday     String?
  thursday      String?
  friday        String?
  saturday      String?
  sunday        String?

  @@unique([planId, week])
  @@map("weekly_programming")
}

enum ChallengeStatus {
  ACTIVE
  COMPLETED
  CANCELLED
}

enum PhysicalTestType {
  TWELVE_MINUTES
  THREE_KM
  FIVE_KM
}

enum TimeOfDay {
  MORNING
  AFTERNOON
  EVENING
}
