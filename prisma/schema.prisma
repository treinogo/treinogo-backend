generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String            @id @default(cuid())
  email          String            @unique
  password       String
  name           String
  phone          String?
  age            Int?
  avatar         String?
  role           Role              @default(ATHLETE)
  birthDate      DateTime?
  cpf            String?
  profession     String?
  cep            String?
  street         String?
  number         String?
  complement     String?
  neighborhood   String?
  city           String?
  state          String?
  biography      String?
  specialization String?
  cref           String?
  website        String?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  athleteProfile AthleteProfile?
  coachProfile   CoachProfile?
  feedbacks      Feedback[]
  notifications  Notification[]
  integrations   UserIntegration[]
  preferences    UserPreferences?

  @@map("users")
}

model AthleteProfile {
  id                      String                 @id @default(cuid())
  userId                  String                 @unique
  level                   Level                  @default(BEGINNER)
  status                  AthleteStatus          @default(ACTIVE)
  currentPlanId           String?
  currentProgress         Int                    @default(0)
  completedTrainings      Int                    @default(0)
  averageTime             String?
  averagePace             String?
  coachId                 String?
  activities              Activity[]
  coach                   CoachProfile?          @relation(fields: [coachId], references: [id])
  currentPlan             TrainingPlan?          @relation(fields: [currentPlanId], references: [id])
  user                    User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  challengeParticipations ChallengeParticipant[]
  physicalTests           PhysicalTest[]
  trainings               Training[]
  raceRegistrations       RaceRegistration[]

  @@map("athlete_profiles")
}

model CoachProfile {
  id            String           @id @default(cuid())
  userId        String           @unique
  athletes      AthleteProfile[]
  challenges    Challenge[]
  user          User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  races         Race[]
  trainingPlans TrainingPlan[]

  @@map("coach_profiles")
}

model TrainingPlan {
  id                String              @id @default(cuid())
  name              String
  category          PlanCategory
  duration          Int
  daysPerWeek       Int
  status            PlanStatus          @default(ACTIVE)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  createdById       String
  athletes          AthleteProfile[]
  createdBy         CoachProfile        @relation(fields: [createdById], references: [id])
  trainings         Training[]
  weeklyProgramming WeeklyProgramming[]

  @@map("training_plans")
}

model Training {
  id         String         @id @default(cuid())
  date       DateTime
  type       TrainingType
  distance   String
  duration   String
  pace       String
  notes      String?
  status     TrainingStatus @default(PENDING)
  weekNumber Int?
  athleteId  String
  planId     String?
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt
  athlete    AthleteProfile @relation(fields: [athleteId], references: [id], onDelete: Cascade)
  plan       TrainingPlan?  @relation(fields: [planId], references: [id])

  @@map("trainings")
}

model Activity {
  id        String         @id @default(cuid())
  type      String
  distance  String
  time      String
  pace      String?
  notes     String?
  athleteId String
  createdAt DateTime       @default(now())
  athlete   AthleteProfile @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  @@map("activities")
}

model Challenge {
  id           String                 @id @default(cuid())
  name         String
  objective    String
  duration     Int
  startDate    DateTime
  endDate      DateTime
  reward       String?
  status       ChallengeStatus        @default(ACTIVE)
  createdAt    DateTime               @default(now())
  updatedAt    DateTime               @updatedAt
  createdById  String
  participants ChallengeParticipant[]
  createdBy    CoachProfile           @relation(fields: [createdById], references: [id])

  @@map("challenges")
}

model ChallengeParticipant {
  id          String         @id @default(cuid())
  challengeId String
  athleteId   String
  progress    Int            @default(0)
  points      Int            @default(0)
  joinedAt    DateTime       @default(now())
  athlete     AthleteProfile @relation(fields: [athleteId], references: [id], onDelete: Cascade)
  challenge   Challenge      @relation(fields: [challengeId], references: [id], onDelete: Cascade)

  @@unique([challengeId, athleteId])
  @@map("challenge_participants")
}

model PhysicalTest {
  id        String           @id @default(cuid())
  athleteId String
  testType  PhysicalTestType
  pace      String
  finalTime String
  distance  Float?
  testDate  DateTime
  createdAt DateTime         @default(now())
  athlete   AthleteProfile   @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  @@map("physical_tests")
}

model Race {
  id          String            @id @default(cuid())
  name        String
  distances   String[]
  city        String
  state       String
  raceDate    DateTime
  timeOfDay   TimeOfDay?
  link        String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  createdById String
  createdBy   CoachProfile      @relation(fields: [createdById], references: [id])
  registrations RaceRegistration[]

  @@map("races")
}

model RaceRegistration {
  id          String         @id @default(cuid())
  raceId      String
  athleteId   String
  distance    String
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  race        Race           @relation(fields: [raceId], references: [id], onDelete: Cascade)
  athlete     AthleteProfile @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  @@unique([raceId, athleteId, distance])
  @@map("race_registrations")
}

model WeeklyProgramming {
  id        String       @id @default(cuid())
  planId    String
  week      Int
  monday    String?
  tuesday   String?
  wednesday String?
  thursday  String?
  friday    String?
  saturday  String?
  sunday    String?
  plan      TrainingPlan @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@unique([planId, week])
  @@map("weekly_programming")
}

model Notification {
  id        String           @id @default(cuid())
  title     String
  message   String
  type      NotificationType @default(INFO)
  isRead    Boolean          @default(false)
  userId    String
  createdAt DateTime         @default(now())
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model Feedback {
  id        String   @id @default(cuid())
  userId    String
  rating    Int
  categoria String
  mensagem  String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("feedbacks")
}

model UserPreferences {
  id                 String   @id @default(cuid())
  userId             String   @unique
  emailNotifications Boolean  @default(true)
  emailReports       Boolean  @default(true)
  emailChallenges    Boolean  @default(false)
  pushNotifications  Boolean  @default(true)
  pushNewAthletes    Boolean  @default(true)
  pushTrainings      Boolean  @default(false)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_preferences")
}

model UserIntegration {
  id           String              @id @default(cuid())
  userId       String
  platform     IntegrationPlatform
  isConnected  Boolean             @default(false)
  accessToken  String?
  refreshToken String?
  lastSync     DateTime?
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  user         User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, platform])
  @@map("user_integrations")
}

model ContactMessage {
  id        String        @id @default(cuid())
  name      String
  email     String
  phone     String?
  subject   String
  message   String
  status    ContactStatus @default(PENDING)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  @@map("contact_messages")
}

enum Role {
  ATHLETE
  COACH
  ADMIN
}

enum Level {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

enum AthleteStatus {
  PENDING
  ACTIVE
  INACTIVE
}

enum PlanCategory {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  FIVE_K
  TEN_K
  HALF_MARATHON
  MARATHON
}

enum PlanStatus {
  ACTIVE
  DRAFT
  ARCHIVED
}

enum TrainingType {
  CONTINUOUS_RUN
  INTERVAL_TRAINING
  LONG_RUN
  FARTLEK
  HILL_TRAINING
  LIGHT_JOG
  RECOVERY_RUN
}

enum TrainingStatus {
  PENDING
  COMPLETED
  MISSED
}

enum ChallengeStatus {
  ACTIVE
  COMPLETED
  CANCELLED
}

enum IntegrationPlatform {
  STRAVA
  POLAR
  GARMIN
}

enum PhysicalTestType {
  TWELVE_MINUTES
  THREE_KM
  FIVE_KM
}

enum TimeOfDay {
  MORNING
  AFTERNOON
  EVENING
}

enum NotificationType {
  INFO
  SUCCESS
  WARNING
  ERROR
}

enum ContactStatus {
  PENDING
  IN_PROGRESS
  RESOLVED
  CLOSED
}
